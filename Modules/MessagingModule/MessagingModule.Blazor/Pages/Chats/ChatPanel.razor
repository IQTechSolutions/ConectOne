@page "/chats"
@page "/chats/{CurrentGroupId}"

@using ConectOne.Blazor.Components
@using ConectOne.Domain.Extensions
@using MessagingModule.Blazor.Components
@using MudBlazor


<MudGrid>
    <MudItem md="6">
        <DefaultTitle Title="Chat Panel" Caption="Communicate with groups and teachers here" />
    </MudItem>
    <MudItem md="6" Style="float:right">
        <MudBreadcrumbs Items="_items" Style="float:right"></MudBreadcrumbs>
    </MudItem>
    <MudItem md="12">  
        <div class="d-flex flex-grow-1 flex-row">
            <MudPaper Elevation="25" Class="py-4 flex-grow-1">
                
                <div style="padding-bottom:15px;">
                    <MessageList Messages="_messages" CurrentUserId="@_currentUserId" CurrentUserName="@_currentUserDisplayName" ReadTimes="_messageReadTimes" />
                </div>
                

                <MessageInput BusySending="@_busySending" OnSendMessage="SendMessageAsync"/>
                
            </MudPaper>

            <ChatGroupList OnGroupMemberSelected="LoadMessagesForGroup" ChatGroups="_chatGroups"/>

        </div>
    </MudItem>
</MudGrid>

<MudDrawer @bind-Open="@_open" Anchor="@_anchor" Elevation="1" Variant="@DrawerVariant.Temporary">
    <div class="pa-3">
        <MudList T="string" Clickable="true">
            @foreach (var member in _chatGroupMembers)
            {
                <MudListItem T="string" Class="pa-0 px-2">
                    <div class="d-flex flex-row mt-n1 mb-n1">
                        <div class="mr-4">
                            <MudBadge Class="my-2" Color="@(GetUserStatusBadgeColor(IsUserOnline(member.UserId)))" Overlap="true" Origin="Origin.BottomCenter" Dot="true">
                                <MudAvatar Color="Color.Dark" Style="height: 50px; width: 50px;">@((member.FirstName + " " + member.LastName).GetInitials())</MudAvatar>
                            </MudBadge>
                        </div>
                        <div>
                            <MudText Typo="Typo.body2" Class="mt-3 mb-n2">@member.FirstName @member.LastName</MudText>
                            <MudText Typo="Typo.caption" Style="font-size: xx-small!important;">@member.EmailAddress</MudText>
                            <MudText Typo="Typo.caption" Class="ml-1" Style="font-size: xx-small!important;">@(IsUserOnline(member.UserId) ? "Online" : "Offline")</MudText>
                        </div>
                    </div>
                </MudListItem>
            }
        </MudList>
    </div>
</MudDrawer>
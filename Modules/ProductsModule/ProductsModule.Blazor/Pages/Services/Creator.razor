@page "/services/create"
@using ConectOne.Blazor.Components
@using Microsoft.AspNetCore.Components.Forms
@using FilingModule.Blazor.Components
@using FilingModule.Blazor.Modals
@using FilingModule.Domain.Enums
@using Microsoft.AspNetCore.Authorization
@using MudBlazor

@attribute [Authorize]

<EditForm Model="_service" OnValidSubmit="CreateAsync">
    <MudGrid>
        <MudItem md="6">
            <DefaultTitle Title="Create Service" Caption="Fill in the service information" />
        </MudItem>
        <MudItem md="6" Style="float:right">
            <MudBreadcrumbs Items="_items" Style="float:right"></MudBreadcrumbs>
        </MudItem>
        <MudItem md="12">
            <DataAnnotationsValidator />
            <MudTabs>

                <MudTabPanel Text="Details">
                    <MudGrid>
                        <MudItem xs="12" sm="12" md="3" lg="3">
                            <MudSingleImageCropperUpload OnFileAccepted="CoverImageChanged" Caption="@_service.Name" Src="@_imageSource" ImageType="UploadType.Cover" TEntity="typeof(Product)" ParentId="@_service.Id"/>
                        </MudItem>
                        <MudItem xs="12" sm="12" md="9" lg="9">
                            <MudCard>
                                <MudCardHeader>
                                    <MudText Align="Align.Center" Typo="Typo.h6">Service Information</MudText>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudGrid>
                                        <MudItem md="6">
                                            <MudTextField Label="Name" Class="mt-3" @bind-Value="_service.Name" For="@(() => _service.Name)" Margin="Margin.Dense" Variant="Variant.Outlined" />
                                        </MudItem>
                                        <MudItem md="6">
                                            <MudTextField Label="Display Name" Class="mt-3" @bind-Value="_service.DisplayName" For="@(() => _service.DisplayName)" Margin="Margin.Dense" Variant="Variant.Outlined" />
                                        </MudItem>

                                        <MudItem md="6">
                                            
                                        </MudItem>
                                        <MudItem md="12">
                                            <MudTextField Label="Short Description" Class="mt-3" @bind-Value="_service.ShortDescription" Lines="3" Margin="Margin.Dense" Variant="Variant.Outlined" />
                                        </MudItem>
                                        <MudItem md="12">
                                            <MudTextField Label="Description" Class="mt-3" @bind-Value="_service.Description" Lines="5" Margin="Margin.Dense" Variant="Variant.Outlined"/>
                                        </MudItem>
                                    </MudGrid>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
                
                <MudTabPanel Text="Pricing">
                    <MudCard>
                        <MudGrid>
                            <MudItem md="4">
                                <MudTextField T="double" Label="Cost of Product" Class="mt-3" @bind-Value="_service.Price" For="@(() => _service.Price)" Margin="Margin.Dense" Variant="Variant.Outlined" />
                            </MudItem>
                            <MudItem md="4">
                                
                            </MudItem>
                            <MudItem md="4">

                            </MudItem>
                        </MudGrid>
                    </MudCard>
                </MudTabPanel>
                
                 @* Images *@
                <MudTabPanel Text="Images" Style="padding-left:20px;">
                    <MudGrid Style="padding:10px;">
                        <MudItem xs="12">
                            <MudButton Variant="Variant.Filled" OnClick="UploadImageAsync" Color="Color.Primary" FullWidth="true">Add Gallery Image</MudButton>
                        </MudItem>

                        @foreach (var item in _galleryImageToUpload)
                        {
                            <MudItem xs="12" sm="4" md="3">
                                <MudGalleryImageCard Image="@item" OnRemoveImage="RemoveOnUploadedImage"></MudGalleryImageCard>
                            </MudItem>
                        }
                    </MudGrid>
                </MudTabPanel>
                
                @* Videos *@
                @* <MudTabPanel Text="Videos" Style="padding-left:20px;">
                    <MudGrid>
                        <MudItem xs="12">
                            <MudStack Style="width: 100%">
                                <MudFileUpload T="IReadOnlyList<IBrowserFile>" @ref="@_fileUpload" OnFilesChanged="OnInputFileChanged" Hidden="@false"
                                               InputClass="absolute mud-width-full mud-height-full overflow-hidden z-10" InputStyle="opacity:0" tabindex="-1"
                                               @ondrop="@ClearDragClass" @ondragenter="@SetDragClass" @ondragleave="@ClearDragClass" @ondragend="@ClearDragClass">
                                    <ActivatorContent>
                                        <MudPaper Height="300px" Outlined="true" Class="@_dragClass">
                                            <MudText Typo="Typo.h6">
                                                Drag and drop files here or click
                                            </MudText>
                                            @foreach (var file in _videosToUpload)
                                            {
                                                <MudChip T="string" Color="Color.Dark" Text="@file.Name" tabindex="-1" />
                                            }
                                        </MudPaper>
                                    </ActivatorContent>
                                </MudFileUpload>
                                @if (_filesBusyUploading.Any())
                                {
                                    foreach (var item in _filesBusyUploading)
                                    {
                                        <MudProgressLinear Color="Color.Primary" Value="@item.Progress" Class="my-7" />
                                    }
                                }
                                <MudToolBar Gutters="@false" Class="relative d-flex justify-end gap-4">
                                    <MudButton Color="Color.Primary" OnClick="@OpenFilePickerAsync" Variant="Variant.Filled">Open file picker</MudButton>
                                    <MudButton Color="Color.Error" Disabled="@(!_videosToUpload.Any())" OnClick="@ClearAsync" Variant="Variant.Filled">Clear</MudButton>
                                </MudToolBar>
                            </MudStack>
                        </MudItem>
                        @foreach (var item in _service.Videos)
                        {
                            <MudItem xs="12" sm="4" md="3">
                                <VideoPlayer SourceUrl="@( $"{Configuration["ApiConfiguration:BaseApiAddress"]}\\{item.Url.Replace("\\", "/")}")" StartAtSeconds="15" />
                            </MudItem>
                        }
                    </MudGrid>
                </MudTabPanel> *@

            </MudTabs>
        </MudItem>

        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Save</MudButton>
        </MudItem>
        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" FullWidth>Cancel</MudButton>
        </MudItem>

    </MudGrid>
</EditForm>


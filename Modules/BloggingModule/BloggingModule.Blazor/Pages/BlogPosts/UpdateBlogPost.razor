@page "/blog/update/{blogId}"
@page "/blog/update/{blogId}/{categoryId}"

@using FilingModule.Blazor.Modals
@using FilingModule.Domain.Enums
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor
@using Radzen.Blazor

<EditForm Model="BlogPost" OnValidSubmit="UpdateAsync">
    <MudGrid>
        <MudItem xs="12" sm="4" md="3">
            <MudSingleImageCropperUpload OnFileAccepted="CoverImageChanged" Caption="@BlogPost.Title" Src="@_imageSource" ImageType="UploadType.Cover" TEntity="typeof(BlogPost)" ParentId="@BlogPost.BlogPostId" />
        </MudItem>
        <MudItem xs="12" sm="8" md="9">
            <MudCard Elevation="25">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText>Blog Information</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" md="12">
                            <MudTextField @bind-Value="BlogPost.Title" Label="Name" For="@(() => BlogPost.Title)" Variant="Variant.Outlined"/>
                        </MudItem>
                        <MudItem xs="12" md="12">
                            <MudTextField @bind-Value="BlogPost.Description" Label="Description" For="@(() => BlogPost.Description)" Lines="4" Variant="Variant.Outlined"/>
                        </MudItem>
                        <MudItem xs="12">
                            <MudSwitch @bind-Value="BlogPost.Featured" Color="Color.Secondary"/> Featured
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="12" md="12">
            <MudCard Elevation="25">
                <MudCardContent>
                    <RadzenHtmlEditor @bind-Value=@BlogPost.Content style="height: 450px;" />
                </MudCardContent>
            </MudCard>
        </MudItem>
        
        <MudItem md="12">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Document Links to Include</MudText>
                </MudCardHeader>
                <MudCardContent>
                    @if (BlogPost.DocumentLinks.Any())
                    {
                        <MudList T="string" Dense="@true" DisableGutters="false">
                            @foreach (var item in BlogPost.DocumentLinks)
                            {
                                        <MudListItem Icon="@Icons.Material.Filled.Attachment">@(string.IsNullOrEmpty(item.Split("/").Last()) ? item.Split("/")[item.Split("/").Length - 2] : item.Split("/").Last())<MudButton Style="float:right" OnClick="@(() => RemoveDocumentLink(item))" Size="Size.Small" Variant="Variant.Filled" Color="Color.Error" Class="ml-auto">Delete</MudButton></MudListItem>
                            }
                        </MudList>
                    }
                    <MudButton OnClick="CreateNotificationLinkAsync" Variant="Variant.Filled" Color="Color.Tertiary" Class="ml-auto" FullWidth>Create New Link</MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudDivider />

        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Save</MudButton>
        </MudItem>
        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" FullWidth>Back</MudButton>
        </MudItem>
    </MudGrid>
</EditForm>

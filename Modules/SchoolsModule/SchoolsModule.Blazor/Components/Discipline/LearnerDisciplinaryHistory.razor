@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor
@using SchoolsModule.Application.ViewModels
@inherits LearnerDisciplinaryHistoryBase

@if (!_loaded)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}
else
{
    <MudGrid>
        <MudItem md="12">
            <MudTable T="DisciplinaryIncidentViewModel" Items="_incidents">
                <HeaderContent>
                    <MudTh>Date</MudTh>
                    <MudTh>Description</MudTh>
                    <MudTh>Action</MudTh>
                    <MudTh>Severity</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Date">@context.Date.Value.ToShortDateString()</MudTd>
                    <MudTd DataLabel="Description">@context.Description</MudTd>
                    <MudTd DataLabel="Action">@_actionLookup.GetValueOrDefault(context.DisciplinaryActionId, context.DisciplinaryActionId)</MudTd>
                    <MudTd DataLabel="Severity">@context.SeverityScore</MudTd>
                </RowTemplate>
            </MudTable>
        </MudItem>
        <MudItem md="12" class="mt-4">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Log New Incident</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <EditForm Model="_newIncident" OnValidSubmit="SaveAsync">
                        <DataAnnotationsValidator />
                        <MudGrid>
                            <MudItem md="6">
                                <MudDatePicker @bind-Date="_newIncident.Date" Label="Date" />
                            </MudItem>
                            <MudItem md="6">
                                <MudSelect T="string" Label="Action" @bind-Value="_newIncident.DisciplinaryActionId">
                                    @foreach (var act in _actions)
                                    {
                                        <MudSelectItem Value="@act.DisciplinaryActionId">@act.Name</MudSelectItem>
                                    }
                                </MudSelect>
                            </MudItem>
                            <MudItem md="12">
                                <MudTextField Label="Description" @bind-Value="_newIncident.Description" Lines="3" />
                            </MudItem>
                            <MudItem md="6">
                                <MudNumericField T="int" Label="Severity" @bind-Value="_newIncident.SeverityScore" />
                            </MudItem>
                            <MudItem md="6" class="d-flex align-center">
                                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Save</MudButton>
                            </MudItem>
                        </MudGrid>
                    </EditForm>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
}

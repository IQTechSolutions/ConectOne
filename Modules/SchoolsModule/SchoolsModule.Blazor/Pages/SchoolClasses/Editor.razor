@page "/schoolclasses/update/{SchoolClassId}"
@using ConectOne.Blazor.Components
@using FilingModule.Blazor.Modals
@using FilingModule.Domain.Enums
@using MessagingModule.Blazor.Components.Messages
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor
@using NeuralTech.Base.Enums
@using SchoolsModule.Blazor.Pages.Attendance
@using SchoolsModule.Domain.DataTransferObjects
@using SchoolsModule.Domain.Entities
@using SchoolsModule.Domain.Enums

@attribute [Authorize]

<EditForm Model="_schoolClass" OnValidSubmit="UpdateAsync">
    <MudGrid>
        <MudItem md="6">
            <DefaultTitle Title="Update Class" Caption="Complete or change to update class information" />
        </MudItem>
        <MudItem md="6" Style="float:right">
            <MudBreadcrumbs Items="_items" Style="float:right"></MudBreadcrumbs>
        </MudItem>
        <MudItem md="12">
    
            <MudTabs>
                <MudTabPanel Text="Details">
                    
                    <DataAnnotationsValidator />
                    <MudGrid>
                        <MudItem xs="12" sm="12" md="3" lg="3">
                            <MudSingleImageCropperUpload OnFileAccepted="CoverImageChanged" Caption="@($"{_schoolClass.SchoolClass}")" Src="@_imageSource" ImageType="UploadType.Cover" Entity="typeof(SchoolClass)" ParentId="@_schoolClass.SchoolClassId" />                            
                        </MudItem>
                        <MudItem xs="12" sm="12" md="9" lg="9">
                            <MudCard>
                                <MudCardHeader>
                                    <MudText Align="Align.Center" Typo="Typo.h6">Personal Information</MudText>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudGrid>
                                        <MudItem md="12">
                                            <MudTextField Label="School Class" Class="mt-3" @bind-Value="_schoolClass.SchoolClass" For="@(() => _schoolClass.SchoolClass)" Margin="Margin.Dense" Variant="Variant.Outlined" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudSwitch @bind-Value="@_schoolClass.AutoCreateChatGroup" Color="Color.Secondary" Style="margin-left: 5px;">
                                                Auto Create Chat Group
                                            </MudSwitch>
                                        </MudItem>
                                        <MudItem xs="4">
                                        </MudItem>
                                        <MudItem xs="4">
                                        </MudItem>
                                    </MudGrid>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>

                    </MudGrid>
                    
                </MudTabPanel>
                <MudTabPanel Text="Teachers">
                    <MudTable Elevation="25" ServerData="TeacherTableLoad" Hover="true" Dense="false" Bordered="true" Striped="true" Context="teacher">
                        <HeaderContent>
                            <MudTh><MudTableSortLabel T="TeacherDto" SortLabel="Title">Title</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel T="TeacherDto" SortLabel="FirstName">First Name</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel T="TeacherDto" SortLabel="LastName">Last Name</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel T="TeacherDto" SortLabel="PhoneNr">Phone Nr</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel T="TeacherDto" SortLabel="Email">Email</MudTableSortLabel></MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Title">
                                @teacher.Title
                            </MudTd>
                            <MudTd DataLabel="First Name">
                                <MudHighlighter Text="@teacher.FirstName" />
                            </MudTd>
                            <MudTd DataLabel="Last Name">
                                <MudHighlighter Text="@teacher.LastName" />
                            </MudTd>
                            <MudTd DataLabel="Grade">
                                <MudHighlighter Text="@teacher.ContactNumber?.Number" />
                            </MudTd>
                            <MudTd DataLabel="Class">
                                <MudHighlighter Text="@teacher.EmailAddress?.EmailAddress" />
                            </MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager PageSizeOptions="new[] { 10, 25, 50, 100 }" />
                        </PagerContent>
                    </MudTable>
                </MudTabPanel>
                <MudTabPanel Text="Learners">
                    <SchoolsModule.Blazor.Components.Learners.LearnersTable SchoolClassId="@_schoolClass.SchoolClassId" />
                </MudTabPanel>
                <MudTabPanel Text="Attendance Reports">
                    <AttendanceGroupList GroupId="@SchoolClassId" AttendanceType="AttendanceType.Class"></AttendanceGroupList>
                </MudTabPanel>
                <MudTabPanel Text="Messages">
                    <MessagesTable MessageType="(int)MessageType.SchoolClass" EntityId="@_schoolClass.SchoolClassId"></MessagesTable>
                </MudTabPanel>
            </MudTabs>
        </MudItem>
        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Save</MudButton>
        </MudItem>
    
        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" FullWidth>Cancel</MudButton>
        </MudItem>
    </MudGrid>
</EditForm>

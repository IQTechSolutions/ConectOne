@page "/activities/activitygroups/create/{CategoryId}"

@using ConectOne.Blazor.Components
@using ConectOne.Domain.Enums
@using FilingModule.Blazor.Modals
@using FilingModule.Domain.Enums
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor
@using SchoolsModule.Application.ViewModels
@using SchoolsModule.Blazor.Components.AgeGroups
@using SchoolsModule.Blazor.Components.Learners.Tables

@attribute [Authorize]

<EditForm Model="_activityGroup" OnValidSubmit="CreateAsync" class="card card-body bg-light mt-5">
    <MudItem md="6">
        <DefaultTitle Title="Create new Team" Caption="Please complete the following information to create a new team" />
    </MudItem>
    <MudItem md="6" Style="float:right">
        <MudBreadcrumbs Items="_items" Style="float:right"></MudBreadcrumbs>
    </MudItem>

    <DataAnnotationsValidator />

    <MudGrid>

        <MudItem xs="12" sm="12" md="4" lg="3">
            <MudSingleImageCropperUpload OnFileAccepted="CoverImageChanged" Caption="@_activityGroup.Name" Src="@_imageSource" ImageType="UploadType.Cover" TEntity="typeof(ActivityGroup)" ParentId="@_activityGroup.CategoryId" />
        </MudItem>

        <MudItem xs="12" sm="12" md="8" lg="9">
            <MudCard>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudTextField Label="Team Name" Class="mt-3" @bind-Value="_activityGroup.Name" For="@(() => _activityGroup.Name)" Margin="Margin.Dense" Variant="Variant.Outlined" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudSwitch @bind-Value="@_activityGroup.AutoCreateChatGroup"
                                       Color="Color.Secondary"
                                       Style="margin-left: 5px;">
                                Auto Create Chat Group
                            </MudSwitch>
                        </MudItem>
                        <MudItem xs="4">
                        </MudItem>
                        <MudItem xs="4">
                        </MudItem>
                        <MudItem xs="12" md="12">
                            <AgeGroupSelectionDropdownBox Variant="Variant.Outlined" AgeGroupChanged="AgeGroupChanged"/>
                        </MudItem>
                        <MudItem xs="12" md="12">
                            <MudSelect T="Gender" Label="Gender" Value="@_activityGroup.Gender" ValueChanged="GenderChanged" For="() => _activityGroup.Gender" AnchorOrigin="Origin.BottomCenter" Variant="Variant.Outlined" ToStringFunc="@(contactMomentType => contactMomentType.ToString())" Margin="Margin.Dense">
                                @foreach (var state in (Gender[])Enum.GetValues(typeof(Gender)))
                                {
                                    <MudSelectItem Value="@state">@state.ToString()</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="12">
                            <MudAutocomplete OpenOnFocus="@(_activityGroup.SelectedTeacher == null)" MaxItems="Int32.MaxValue" T="TeacherViewModel" Label="Select the coach" @bind-Value="_activityGroup.SelectedTeacher" 
                                             SearchFunc="@AutoCompleteSearch" ToStringFunc="@teacherConverter" Variant="Variant.Outlined" Margin="Margin.Dense"/>


                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" sm="12" md="12" lg="12">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h6">My Dependents</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <LearnersTableV2 @ref="_table" AgeGroup="_activityGroup.SelectedAgeGroup" Gender="_activityGroup.Gender" ActivityGroupId="@_activityGroup.ActivityGroupId"  OnSelectionChange="LearnerTableSelectedItemsChanged"></LearnersTableV2>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Save</MudButton>
        </MudItem>

        <MudItem xs="6" sm="6" md="6" lg="6">
            <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" FullWidth>Cancel</MudButton>
        </MudItem>
    </MudGrid>

</EditForm>
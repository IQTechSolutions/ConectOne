@using ConectOne.Domain.Mailing
@using IdentityModule.Domain.Entities
@using IdentityModule.Domain.Interfaces
@using Microsoft.AspNetCore.Identity
@using MudBlazor
@using NelspruitHigh.Blazor.ServerClient.Components.Account.Shared
@using SchoolsModule.Domain.Interfaces
@using SchoolsModule.Domain.Interfaces.Learners
@inject UserManager<ApplicationUser> UserManager
@inject IUserStore<ApplicationUser> UserStore
@inject IRoleService RoleService
@inject SignInManager<ApplicationUser> SignInManager
@inject ILogger<RegisterForm> Logger
@inject NavigationManager NavigationManager
@inject IdentityRedirectManager RedirectManager
@inject IConfiguration Configuration
@inject ISnackbar SnackBar
@inject ILearnerQueryService LearnerQueryService
@inject ITeacherService TeacherService
@inject DefaultEmailSender EmailSender
@inject IUserService UserService

@rendermode InteractiveServer

<div style="text-align:center">
    <EditForm Model="Input" method="post" OnValidSubmit="RegisterUser" FormName="register" class="card card-body bg-light">
        <MudGrid Style="max-width:800px; margin-left:50%; transform:translate(-50%);">
            <MudItem xs="12" md="12" lg="12" xl="12">
                <div class="justify-center">
                    <MudImage Src="@($"{Configuration.GetValue<string>("EmailConfiguration:logoUrl")}")" Style="width: 150px;" />
                </div>
            </MudItem>
            <MudItem xs="12" md="12" lg="12" xl="12">
                <div class="d-flex justify-center">
                    <MudText>Please enter your details to register for a new account</MudText>
                </div>
            </MudItem>
            <MudItem xs="12" md="12" lg="12" xl="12">
                <StatusMessage Message="@Message" />
                <ValidationSummary class="text-danger" role="alert" />
                <DataAnnotationsValidator />
            </MudItem>
            <MudItem xs="12" md="12" lg="12" xl="12">
                <div class="justify-center">
                    <h2>@($"{Configuration.GetValue<string>("ApplicationConfiguration:ApplicationName")} School Admin")</h2>
                </div>
            </MudItem>

            <MudItem xs="12" md="12" lg="12" xl="12">
                <div class="justify-center">
                    <MudText><strong>Create a new account.</strong></MudText>
                </div>
            </MudItem>

            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText @bind-Value="Input.FirstName" id="Input.FirstName" class="form-control" autocomplete="firstname" aria-required="true" />
                    <label for="Input.FirstName">First Name</label>
                    <ValidationMessage For="() => Input.FirstName" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText @bind-Value="Input.LastName" id="Input.LastName" class="form-control" autocomplete="lastname" aria-required="true" />
                    <label for="Input.LastName">Last Name</label>
                    <ValidationMessage For="() => Input.LastName" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText @bind-Value="Input.Email" id="Input.Email" class="form-control" autocomplete="username" aria-required="true" />
                    <label for="Input.Email">Email</label>
                    <ValidationMessage For="() => Input.Email" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText @bind-Value="Input.PhoneNumber" id="Input.PhoneNumber" class="form-control" autocomplete="phonenumber" aria-required="true" />
                    <label for="Input.Email">Phone Nr</label>
                    <ValidationMessage For="() => Input.PhoneNumber" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12" md="12" lg="12" xl="12">
                <div class="form-floating mb-3">
                    <InputSelect @bind-Value="Input.SelectedOption" style="width:100%" class="form-control">
                        <option value="">Select a Role</option>
                        @foreach (var role in _availableRoles)
                        {
                            <option value="@role">@role</option>
                        }
                    </InputSelect>
                </div>
            </MudItem>
            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText type="password" @bind-Value="Input.Password" id="Input.Password" class="form-control" autocomplete="new-password" aria-required="true" />
                    <label for="Input.Password">Password</label>
                    <ValidationMessage For="() => Input.Password" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12" md="6" lg="6" xl="6">
                <div class="form-floating mb-3">
                    <InputText type="password" @bind-Value="Input.ConfirmPassword" id="Input.ConfirmPassword" class="form-control" autocomplete="new-password" aria-required="true" />
                    <label for="Input.ConfirmPassword">Confirm Password</label>
                    <ValidationMessage For="() => Input.ConfirmPassword" class="text-danger" />
                </div>
            </MudItem>
            <MudItem xs="12">
                <div class="d-flex justify-center">
                    <MudText>Already have an account? <MudLink OnClick="@(() => NavigationManager.NavigateTo($"Account/Login?returnUrl=", forceLoad: true))">Sign In</MudLink></MudText>
                </div>
            </MudItem>
            <MudItem xs="12" Class="d-flex justify-center">
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" Style="width: 100%;">Register Now</MudButton>
            </MudItem>
            <MudItem xs="12">
                <div class="d-flex justify-center">
                    <MudImage Src="@($"{Configuration.GetValue<string>("EmailConfiguration:caption")}")" Style="width: 100px;" />
                </div>
            </MudItem>
        </MudGrid>
    </EditForm>
</div>
@using AccomodationModule.Domain.Enums
@using MudBlazor

<MudCard Style="width:100%">
    <MudCardContent>
        <MudCard Style="width:100%; padding-left:20px;">
            <MudCardContent>
                <MudGrid>
                    <MudItem md="12">
                        <MudTabs>
                            @if (Vacation.Meals.Any(c => c.MealAdditionTemPlate.MealType == MealType.Breakfast))
                            {
                                <MudTabPanel Text="Breakfasts">
                                    <MudTable Items="Vacation.Meals.Where(c => Vacation.StartDate?.AddDays(c.DayNr-1) != Vacation.StartDate && c.MealAdditionTemPlate.MealType == MealType.Breakfast).OrderBy(c => c.DayNr).ThenBy(c => c.MealAdditionTemPlate.GuestType)" Elevation="25">
                                        <HeaderContent>
                                            <MudTh>Date</MudTh>
                                            <MudTh>Restaurant</MudTh>
                                            <MudTh>Start Time</MudTh>
                                            <MudTh>Guest Type</MudTh>
                                            <MudTh></MudTh>
                                        </HeaderContent>
                                        <RowTemplate>
                                            <MudTd>@Vacation.StartDate?.AddDays(context.DayNr-1 ).ToLongDateString()</MudTd>
                                            <MudTd>@context.MealAdditionTemPlate.Restaurant.Name</MudTd>
                                            <MudTd>@(context.StartTime == null ? "tba" : context.StartTime)</MudTd>
                                            <MudTd>@((GuestType)context.MealAdditionTemPlate.GuestType)</MudTd>
                                            <MudTd Style="float:right;">
                                                @if (!context.IntervalInclusion)
                                                {
                                                    <MudMenu Label="Actions" Variant="Variant.Filled" DisableElevation="true" EndIcon="@Icons.Material.Filled.KeyboardArrowDown" IconColor="Color.Secondary" AnchorOrigin="Origin.TopLeft">
                                                        <MudMenuItem OnClick="@(() => UpdateMealAddition(context))" Icon="@Icons.Material.Filled.Edit">Edit</MudMenuItem>
                                                        <MudMenuItem OnClick="@(() => RemoveMealAddition(context.MealAdditionId))" Icon="@Icons.Material.Filled.Delete">Delete</MudMenuItem>
                                                    </MudMenu>
                                                }
                                            </MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudTabPanel>
                            }
                            @if (Vacation.Meals.Any(c => c.MealAdditionTemPlate.MealType == MealType.Lunch))
                            {
                                <MudTabPanel Text="Lunches">
                                    <MudTable Items="Vacation.Meals.Where(c => Vacation.StartDate?.AddDays(c.DayNr-1) != Vacation.StartDate && c.MealAdditionTemPlate.MealType == MealType.Lunch).OrderBy(c => c.DayNr).ThenBy(c => c.MealAdditionTemPlate.GuestType)" Elevation="25">
                                        <HeaderContent>
                                            <MudTh>Date</MudTh>
                                            <MudTh>Restaurant</MudTh>
                                            <MudTh>Start Time</MudTh>
                                            <MudTh>Guest Type</MudTh>
                                            <MudTh></MudTh>
                                        </HeaderContent>
                                        <RowTemplate>
                                            <MudTd>@Vacation.StartDate?.AddDays(context.DayNr-1).ToLongDateString()</MudTd>
                                            <MudTd>@context.MealAdditionTemPlate.Restaurant.Name</MudTd>
                                            <MudTd>@(context.StartTime == null ? "tba" : context.StartTime)</MudTd>
                                            <MudTd>@((GuestType)context.MealAdditionTemPlate.GuestType)</MudTd>
                                            <MudTd Style="float:right;">
                                                @if (!context.IntervalInclusion)
                                                {
                                                    <MudMenu Label="Actions" Variant="Variant.Filled" DisableElevation="true" EndIcon="@Icons.Material.Filled.KeyboardArrowDown" IconColor="Color.Secondary" AnchorOrigin="Origin.TopLeft">
                                                        <MudMenuItem OnClick="@(() => UpdateMealAddition(context))" Icon="@Icons.Material.Filled.Edit">Edit</MudMenuItem>
                                                        <MudMenuItem OnClick="@(() => RemoveMealAddition(context.MealAdditionId))" Icon="@Icons.Material.Filled.Delete">Delete</MudMenuItem>
                                                    </MudMenu>
                                                }
                                            </MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudTabPanel>
                            }
                            @if (Vacation.Meals.Any(c => c.MealAdditionTemPlate.MealType == MealType.Dinner))
                            {
                                <MudTabPanel Text="Dinners">
                                    <MudTable Items="Vacation.Meals.Where(c => c.MealAdditionTemPlate.MealType == MealType.Dinner).OrderBy(c => c.DayNr-1).ThenBy(c => c.MealAdditionTemPlate.GuestType)" Elevation="25">
                                        <HeaderContent>
                                            <MudTh>Date</MudTh>
                                            <MudTh>Restaurant</MudTh>
                                            <MudTh>Start Time</MudTh>
                                            <MudTh>Guest Type</MudTh>
                                            <MudTh></MudTh>
                                        </HeaderContent>
                                        <RowTemplate>
                                            <MudTd>@Vacation.StartDate?.AddDays(context.DayNr-1).ToLongDateString()</MudTd>
                                            <MudTd>@context.MealAdditionTemPlate.Restaurant.Name</MudTd>
                                            <MudTd>@(context.StartTime == null ? "tba" : context.StartTime)</MudTd>
                                            <MudTd>@((GuestType)context.MealAdditionTemPlate.GuestType)</MudTd>
                                            <MudTd Style="float:right;">
                                                @if (!context.IntervalInclusion)
                                                {
                                                    <MudMenu Label="Actions" Variant="Variant.Filled" DisableElevation="true" EndIcon="@Icons.Material.Filled.KeyboardArrowDown" IconColor="Color.Secondary" AnchorOrigin="Origin.TopLeft">
                                                        <MudMenuItem OnClick="@(() => UpdateMealAddition(context))" Icon="@Icons.Material.Filled.Edit">Edit</MudMenuItem>
                                                        <MudMenuItem OnClick="@(() => RemoveMealAddition(context.MealAdditionId))" Icon="@Icons.Material.Filled.Delete">Delete</MudMenuItem>
                                                    </MudMenu>
                                                }
                                            </MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudTabPanel>
                            }
                        </MudTabs>
                    </MudItem>
                    <MudItem md="12">
                        <MudButton Variant="Variant.Filled" FullWidth="true" Color="Color.Primary" StartIcon="@Icons.Material.Filled.CloudUpload" OnClick="CreateMealAddition">
                            New Meal Item
                        </MudButton>
                    </MudItem>
                    
                    @if (Update.HasDelegate)
                    {
                        <MudItem xs="4" sm="4" md="4" lg="4">
                            <MudButton OnClick="OnUpdate" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Next</MudButton>
                        </MudItem>
                    }
                    @if (NextTab.HasDelegate)
                    {
                        <MudItem xs="4" sm="4" md="4" lg="4">
                            <MudButton OnClick="OnNextTab" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" FullWidth>Next</MudButton>
                        </MudItem>
                    }
                    <MudItem xs="4" sm="4" md="4" lg="4">
                        <MudButton OnClick="OnPreviousTab" Variant="Variant.Filled" Color="Color.Info" Class="ml-auto" FullWidth>Back</MudButton>
                    </MudItem>
                    <MudItem xs="4" sm="4" md="4" lg="4">
                        <MudButton OnClick="OnCancel" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto" FullWidth>Cancel</MudButton>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
        </MudCard>
    </MudCardContent>
</MudCard>
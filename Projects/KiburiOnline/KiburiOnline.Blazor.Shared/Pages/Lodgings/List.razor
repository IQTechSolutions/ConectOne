@page "/lodgings"

@using ConectOne.Blazor.Components
@using ConectOne.Domain.Extensions
@using FilingModule.Domain.Enums
@using KiburiOnline.Blazor.Shared.Layouts
@using MudBlazor
@using static Microsoft.AspNetCore.Components.Web.RenderMode
@rendermode InteractiveServer

@layout WebsiteLayout

<HeadContent>
    <!-- Robots -->
    <meta name="robots" content="noindex, nofollow" />
</HeadContent>

<div id="hotel-main-content" class="card card-body bg-light mt-5">

    <DefaultTitle Title="Hotel Index" Caption="This is a paged list of all the current hotels available"/>

    <MudToolBar>
        @if (_canSearchLodging)
        {
            <div class="form-group" style="width:100%; padding-right:15px;">
                <input asp-for="Params.SearchText" class="form-control" placeholder="Type to Search"/>
            </div>
            <div style="padding-right:15px;">
                <MudButton Variant="Variant.Filled" OnClick="Search" StartIcon="@Icons.Material.Filled.Search" Color="Color.Tertiary" IconColor="Color.Surface">Search</MudButton>
            </div>
            <MudSpacer/>
        }
        
        <div style="padding-right:15px;">
            <MudButton Variant="Variant.Filled" OnClick="ClearFiltersAsync" StartIcon="@Icons.Material.Filled.Refresh" Color="Color.Secondary" IconColor="Color.Surface">Reload</MudButton>
        </div>
        
        @if (_canCreateLodging)
        {
            <MudSpacer/>
            <div style="padding-right:15px;">
                <MudButton Variant="Variant.Filled" Href="/lodgings/create" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" IconColor="Color.Surface">Create</MudButton>
            </div>
        }
    </MudToolBar>
    
    <MudTable RowsPerPage="25" Elevation="25" ServerData="GetLodgingsAsync" Dense="@_dense" Bordered="@_bordered" Striped="@_striped" Hover="true" @ref="_table">

        <ToolBarContent>
            @if (_canSearchLodging)
            {
                <MudSwitch @bind-Value:get="@_pageParameters.Active" @bind-Value:set="CheckedChanged" Color="Color.Success">Active</MudSwitch>
                <MudSpacer/>
                <MudSwitch @bind-Value:get="@_pageParameters.Featured" @bind-Value:set="FeaturedChanged" Disabled=@(_pageParameters.Active == false) Color="Color.Success">Featured</MudSwitch>
                <MudSpacer/>
                <MudSwitch @bind-Value:get="@_showFilter" @bind-Value:set="ShowFilters" Color="Color.Success">Show Filter</MudSwitch>
                <MudSpacer/>
                <MudTablePager PageSizeOptions="new[] { 10, 25, 50, 100 }"/>
            }
        </ToolBarContent>

        <HeaderContent>
            @if (!_dense)
            {
                <MudTh>Cover</MudTh>
            }
            <MudTh>Name</MudTh>
            <MudTh>Description</MudTh>
            <MudTh>
                <div style="float:right">
                    <MudMenu Icon="@Icons.Material.Filled.Settings" Color="Color.Primary" AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.BottomLeft">
                        <MudMenuItem><MudSwitch @bind-Value="@_dense" Color="Color.Secondary" Style="margin-left: 5px;">Dense</MudSwitch></MudMenuItem>
                        <MudMenuItem><MudSwitch @bind-Value="@_striped" Color="Color.Tertiary" Style="margin-left: 5px;">Striped</MudSwitch></MudMenuItem>
                        <MudMenuItem><MudSwitch @bind-Value="@_bordered" Color="Color.Warning" Style="margin-left: 5px;">Bordered</MudSwitch></MudMenuItem>
                    </MudMenu>
                </div>
            </MudTh>
        </HeaderContent>

        <RowTemplate>
            @if (!_dense)
            {
                <MudTd><MudImage Width="100" Height="70" Src="@(context.Details.Images?.FirstOrDefault(c => c.ImageType == UploadType.Cover) is null ? "_content/Accomodation.Blazor/images/NoImage.jpg" : $"{Configuration["ApiConfiguration:BaseApiAddress"]}\\{context.Details.Images?.FirstOrDefault(c => c.ImageType == UploadType.Cover).RelativePath.TrimStart('/')}")" /> </MudTd>
            }
            <MudTd>@context.Details.Name</MudTd>
            <MudTd><strong>@context.Details.Description.HtmlToPlainText().TruncateLongString(150)</strong></MudTd>
            <MudTd DataLabel="Actions" Style="text-align: right">
                <MudMenu Label="Actions" Variant="Variant.Filled" DisableElevation="true" EndIcon="@Icons.Material.Filled.KeyboardArrowDown" IconColor="Color.Secondary" AnchorOrigin="Origin.TopLeft">
                    @if (_canEditLodging)
                    {
                        <MudMenuItem Icon="@Icons.Material.Filled.Edit" Href="@($"/lodgings/{@context.Details.LodgingId}")">Edit</MudMenuItem>
                    }
                    @if (_canRemoveLodging)
                    {
                        <MudMenuItem Icon="@Icons.Material.Filled.Delete" @onclick="@(() => DeleteLodging(context.Details.LodgingId))">Delete</MudMenuItem>
                    }
                </MudMenu>
            </MudTd>
        </RowTemplate>

        <PagerContent>
            <MudTablePager PageSizeOptions="new[] { 10, 25, 50, 100 }"/>
        </PagerContent>

    </MudTable>

</div>

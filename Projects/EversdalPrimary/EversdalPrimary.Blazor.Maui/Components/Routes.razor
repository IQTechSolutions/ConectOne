@using Microsoft.AspNetCore.Components.Authorization
@using SchoolsEnterprise.Blazor.Shared.Maui.Components.Layout
@using ShoppingModule.Blazor.Components
@inject NavigationManager NavigationManager
@inject EversdalPrimary.Blazor.Maui.Services.NotificationNavigationService NotificationNavigationService

<CartStateProvider>
    <CascadingAuthenticationState>
        <Router AppAssembly="typeof(MauiProgram).Assembly" NotFoundPage="typeof(Pages.NotFound)" AdditionalAssemblies="new[] { typeof(SchoolsEnterprise.Blazor.Shared.Maui.AssemblyReference).Assembly }">
            <Found Context="routeData">
                <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                    <NotAuthorized>
                        <RedirectToLogin2 />
                    </NotAuthorized>
                </AuthorizeRouteView>
            </Found>
        </Router>
    </CascadingAuthenticationState>
</CartStateProvider>

@code {
    private bool _navigationRegistered;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && !_navigationRegistered)
        {
            NotificationNavigationService.RegisterNavigationManager(NavigationManager);
            _navigationRegistered = true;
        }

        base.OnAfterRender(firstRender);
    }
}
